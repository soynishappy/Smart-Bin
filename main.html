<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8" />
  <title>메인 페이지</title>
<style>
  * {
    box-sizing: border-box;
    margin: 0;
    padding: 0;
  }

  body {
    font-family: Arial, sans-serif;
    background-color: #f2f2f2;
    padding: 25px;
    display: flex;
    justify-content: center;
    align-items: center;
    min-height: 100vh;
  }

  .container {
    background-color: #fff;
    padding: 40px;
    border-radius: 16px;
    box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
    width: 100%;
    max-width: 420px;
    text-align: center;
  }

  h1 {
    font-size: 32px;
    margin-bottom: 25px;
  }

  p {
    font-size: 20px;
    margin: 14px 0;
  }

  button {
    width: 100%;
    padding: 18px;
    margin-top: 14px;
    background-color: #4CAF50;
    color: white;
    border: none;
    border-radius: 12px;
    font-size: 18px;
    cursor: pointer;
    transition: background-color 0.3s ease;
  }

  button:hover {
    background-color: #45a049;
  }

  #button-group {
    display: flex;
    gap: 14px;
    margin-top: 28px;
    flex-direction: column;
  }

  @media (min-width: 480px) {
    #button-group {
      flex-direction: row;
    }
  }
</style>
</head>
<body>
  <h2>환영합니다!</h2>
  <p id="user-info">사용자 정보를 불러오는 중...</p>
  <p>포인트: <span id="points">0</span></p>

  <button id="add-point-btn">포인트 적립 (테스트용)</button>
  <button id="logout">로그아웃</button>

  <!-- Firebase SDK -->
  <script src="https://www.gstatic.com/firebasejs/9.22.1/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.22.1/firebase-auth-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.22.1/firebase-database-compat.js"></script>

  <script>
    const firebaseConfig = {
      apiKey: "AIzaSyAVtB-5G932ZqNpn7a541p2iXZ_ZYGW-nU",
      authDomain: "smart-5c491.firebaseapp.com",
      projectId: "smart-5c491",
      storageBucket: "smart-5c491.appspot.com",
      messagingSenderId: "1002873500741",
      appId: "1:1002873500741:web:f3e9e142e00a6350d6df2c",
      measurementId: "G-YMSX9299M2",
      databaseURL: "https://smart-5c491-default-rtdb.firebaseio.com"
    };
    firebase.initializeApp(firebaseConfig);

    // 로그인 상태 확인
    firebase.auth().onAuthStateChanged(user => {
      if (user) {
        document.getElementById("user-info").textContent = `환영합니다, ${user.email}님!`;
        firebase.database().ref("users/" + user.uid + "/points").once("value").then(snapshot => {
          const points = snapshot.val() || 0;
          document.getElementById("points").textContent = points;
        });
      } else {
        const fromLogout = localStorage.getItem("justLoggedOut");
        if (!fromLogout) {
          alert("로그인이 필요합니다.");
        }
        window.location.href = "login.html";
      }
    });

    // 포인트 적립
    document.getElementById('add-point-btn').addEventListener('click', () => {
      const user = firebase.auth().currentUser;
      if (!user) return alert("로그인이 필요합니다.");

      const userRef = firebase.database().ref('users/' + user.uid);
      userRef.once('value').then(snapshot => {
        const currentPoints = snapshot.val()?.points || 0;
        const newPoints = currentPoints + 1;
        userRef.update({ points: newPoints });
        alert(`포인트 적립 완료! 현재 포인트: ${newPoints}`);
        document.getElementById("points").textContent = newPoints;
      });
    });

    // 로그아웃
    document.getElementById("logout").addEventListener("click", () => {
      firebase.auth().signOut().then(() => {
        localStorage.setItem("justLoggedOut", "true");
        alert("로그아웃 되었습니다.");
        window.location.href = "login.html";
      });
    });
  </script>
</body>
</html>
